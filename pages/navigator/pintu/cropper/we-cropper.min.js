var t, e = require("../../@babel/runtime/helpers/interopRequireDefault")(require("../../@babel/runtime/helpers/typeof")), n = "function" == typeof Symbol && "symbol" == (0, 
e.default)(Symbol.iterator) ? function(t) {
    return (0, e.default)(t);
} : function(t) {
    return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : (0, 
    e.default)(t);
};

t = function() {
    function t(t) {
        for (var e = [], n = arguments.length - 1; 0 < n--; ) e[n] = arguments[n + 1];
        u.forEach(function(n, o) {
            void 0 !== e[o] && (t[n] = e[o]);
        });
    }
    function e() {
        return c || (c = wx.getSystemInfoSync()), c;
    }
    function o(t, e) {
        return t(e = {
            exports: {}
        }, e.exports), e.exports;
    }
    function r(t) {
        return function(e) {
            for (var n = [], o = arguments.length - 1; 0 < o--; ) n[o] = arguments[o + 1];
            return void 0 === e && (e = {}), new Promise(function(o, r) {
                e.success = function(t) {
                    o(t);
                }, e.fail = function(t) {
                    r(t);
                }, t.apply(void 0, [ e ].concat(n));
            });
        };
    }
    function i(t, e) {
        return void 0 === e && (e = !1), new Promise(function(n) {
            t.draw(e, n);
        });
    }
    function a(t) {
        var e = "";
        if ("string" == typeof t) e = t; else for (var n = 0; n < t.length; n++) e += String.fromCharCode(t[n]);
        return m.encode(e);
    }
    var c = void 0, u = [ "touchstarted", "touchmoved", "touchended" ], s = {}, d = {
        id: {
            default: "cropper",
            get: function() {
                return s.id;
            },
            set: function(t) {
                "string" != typeof t && console.error("id：" + t + " is invalid"), s.id = t;
            }
        },
        width: {
            default: 750,
            get: function() {
                return s.width;
            },
            set: function(t) {
                "number" != typeof t && console.error("width：" + t + " is invalid"), s.width = t;
            }
        },
        height: {
            default: 750,
            get: function() {
                return s.height;
            },
            set: function(t) {
                "number" != typeof t && console.error("height：" + t + " is invalid"), s.height = t;
            }
        },
        pixelRatio: {
            default: e().pixelRatio,
            get: function() {
                return s.pixelRatio;
            },
            set: function(t) {
                "number" != typeof t && console.error("pixelRatio：" + t + " is invalid"), s.pixelRatio = t;
            }
        },
        scale: {
            default: 2.5,
            get: function() {
                return s.scale;
            },
            set: function(t) {
                "number" != typeof t && console.error("scale：" + t + " is invalid"), s.scale = t;
            }
        },
        zoom: {
            default: 5,
            get: function() {
                return s.zoom;
            },
            set: function(t) {
                "number" != typeof t ? console.error("zoom：" + t + " is invalid") : (t < 0 || 10 < t) && console.error("zoom should be ranged in 0 ~ 10"), 
                s.zoom = t;
            }
        },
        src: {
            default: "",
            get: function() {
                return s.src;
            },
            set: function(t) {
                "string" != typeof t && console.error("src：" + t + " is invalid"), s.src = t;
            }
        },
        cut: {
            default: {},
            get: function() {
                return s.cut;
            },
            set: function(t) {
                "object" != (void 0 === t ? "undefined" : n(t)) && console.error("cut：" + t + " is invalid"), 
                s.cut = t;
            }
        },
        boundStyle: {
            default: {},
            get: function() {
                return s.boundStyle;
            },
            set: function(t) {
                "object" != (void 0 === t ? "undefined" : n(t)) && console.error("boundStyle：" + t + " is invalid"), 
                s.boundStyle = t;
            }
        },
        onReady: {
            default: null,
            get: function() {
                return s.ready;
            },
            set: function(t) {
                s.ready = t;
            }
        },
        onBeforeImageLoad: {
            default: null,
            get: function() {
                return s.beforeImageLoad;
            },
            set: function(t) {
                s.beforeImageLoad = t;
            }
        },
        onImageLoad: {
            default: null,
            get: function() {
                return s.imageLoad;
            },
            set: function(t) {
                s.imageLoad = t;
            }
        },
        onBeforeDraw: {
            default: null,
            get: function() {
                return s.beforeDraw;
            },
            set: function(t) {
                s.beforeDraw = t;
            }
        }
    }, f = e().windowWidth, h = "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : {}, l = o(function(t, e) {
        e.isStr = function(t) {
            return "string" == typeof t;
        }, e.isNum = function(t) {
            return "number" == typeof t;
        }, e.isArr = Array.isArray, e.isUndef = function(t) {
            return void 0 === t;
        }, e.isTrue = function(t) {
            return !0 === t;
        }, e.isFalse = function(t) {
            return !1 === t;
        }, e.isFunc = function(t) {
            return "function" == typeof t;
        }, e.isObj = e.isObject = function(t) {
            return null !== t && "object" == (void 0 === t ? "undefined" : n(t));
        };
        var o = Object.prototype.toString;
        e.isPlainObject = function(t) {
            return "[object Object]" === o.call(t);
        };
        var r = Object.prototype.hasOwnProperty;
        e.hasOwn = function(t, e) {
            return r.call(t, e);
        }, e.noop = function(t, e, n) {}, e.isValidArrayIndex = function(t) {
            var e = parseFloat(String(t));
            return 0 <= e && Math.floor(e) === e && isFinite(t);
        };
    }), p = l.isFunc, g = l.isPlainObject, v = [ "ready", "beforeImageLoad", "beforeDraw", "imageLoad" ], y = r(wx.getImageInfo), x = r(wx.canvasToTempFilePath), m = o(function(t, e) {
        !function(o) {
            var r = e, i = t && t.exports == r && t, a = "object" == (void 0 === h ? "undefined" : n(h)) && h;
            a.global !== a && a.window !== a || (o = a);
            var c = function(t) {
                this.message = t;
            };
            (c.prototype = new Error()).name = "InvalidCharacterError";
            var u = function(t) {
                throw new c(t);
            }, s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", d = /[\t\n\f\r ]/g, f = {
                encode: function(t) {
                    t = String(t), /[^\0-\xFF]/.test(t) && u("The string to be encoded contains characters outside of the Latin1 range.");
                    for (var e, n, o, r, i = t.length % 3, a = "", c = -1, d = t.length - i; ++c < d; ) e = t.charCodeAt(c) << 16, 
                    n = t.charCodeAt(++c) << 8, o = t.charCodeAt(++c), a += s.charAt((r = e + n + o) >> 18 & 63) + s.charAt(r >> 12 & 63) + s.charAt(r >> 6 & 63) + s.charAt(63 & r);
                    return 2 == i ? (e = t.charCodeAt(c) << 8, n = t.charCodeAt(++c), a += s.charAt((r = e + n) >> 10) + s.charAt(r >> 4 & 63) + s.charAt(r << 2 & 63) + "=") : 1 == i && (r = t.charCodeAt(c), 
                    a += s.charAt(r >> 2) + s.charAt(r << 4 & 63) + "=="), a;
                },
                decode: function(t) {
                    var e = (t = String(t).replace(d, "")).length;
                    e % 4 == 0 && (e = (t = t.replace(/==?$/, "")).length), (e % 4 == 1 || /[^+a-zA-Z0-9\/]/.test(t)) && u("Invalid character: the string to be decoded is not correctly encoded.");
                    for (var n, o, r = 0, i = "", a = -1; ++a < e; ) o = s.indexOf(t.charAt(a)), n = r % 4 ? 64 * n + o : o, 
                    r++ % 4 && (i += String.fromCharCode(255 & n >> (-2 * r & 6)));
                    return i;
                },
                version: "0.1.0"
            };
            if (r && !r.nodeType) if (i) i.exports = f; else for (var l in f) f.hasOwnProperty(l) && (r[l] = f[l]); else o.base64 = f;
        }(h);
    }), b = function(t, e) {
        return void 0 === t && (t = {}), void 0 === e && (e = function() {}), function(t, e, n, o, r, i, c) {
            var u, s, d, f, h, l;
            void 0 === c && (c = function() {}), void 0 === i && (i = "png"), i = "image/" + i.toLowerCase().replace(/jpg/i, "jpeg").match(/png|jpeg|bmp|gif/)[0], 
            /bmp/.test(i) ? (u = t, s = e, d = n, f = o, h = r, l = function(t, e) {
                var n = function(t) {
                    var e = t.width, n = t.height, o = e * n * 3, r = o + 54, i = [ 66, 77, 255 & r, r >> 8 & 255, r >> 16 & 255, r >> 24 & 255, 0, 0, 0, 0, 54, 0, 0, 0 ], c = [ 40, 0, 0, 0, 255 & e, e >> 8 & 255, e >> 16 & 255, e >> 24 & 255, 255 & n, n >> 8 & 255, n >> 16 & 255, n >> 24 & 255, 1, 0, 24, 0, 0, 0, 0, 0, 255 & o, o >> 8 & 255, o >> 16 & 255, o >> 24 & 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], u = (4 - 3 * e % 4) % 4, s = t.data, d = "", f = e << 2, h = n, l = String.fromCharCode;
                    do {
                        for (var p = f * (h - 1), g = "", v = 0; v < e; v++) {
                            var y = v << 2;
                            g += l(s[p + y + 2]) + l(s[p + y + 1]) + l(s[p + y]);
                        }
                        for (var x = 0; x < u; x++) g += String.fromCharCode(0);
                        d += g;
                    } while (--h);
                    return a(i.concat(c)) + a(d);
                }(t);
                p(c) && c("data:image/" + i + ";base64," + n, e);
            }, wx.canvasGetImageData({
                canvasId: u,
                x: s,
                y: d,
                width: f,
                height: h,
                success: function(t) {
                    l(t, null);
                },
                fail: function(t) {
                    l(null, t);
                }
            })) : console.error("暂不支持生成'" + i + "'类型的base64图片");
        }(t.canvasId, t.x, t.y, t.width, t.height, "bmp", e);
    }, w = {
        touchStart: function(e) {
            var n = e.touches, o = n[0], r = n[1];
            this.src && (t(this, !0, null, null), this.__oneTouchStart(o), 2 <= e.touches.length && this.__twoTouchStart(o, r));
        },
        touchMove: function(e) {
            var n = e.touches, o = n[0], r = n[1];
            this.src && (t(this, null, !0), 1 === e.touches.length && this.__oneTouchMove(o), 
            2 <= e.touches.length && this.__twoTouchMove(o, r));
        },
        touchEnd: function(e) {
            this.src && (t(this, !1, !1, !0), this.__xtouchEnd());
        }
    }, S = function(t) {
        var e, n, o = this, r = {};
        return e = o, n = d, Object.defineProperties(e, n), Object.keys(d).forEach(function(t) {
            r[t] = d[t].default;
        }), Object.assign(o, r, t), o.prepare(), o.attachPage(), o.createCtx(), o.observer(), 
        o.cutt(), o.methods(), o.init(), o.update(), o;
    };
    return S.prototype.init = function() {
        var e = this, n = e.src;
        return e.version = "1.3.9", "function" == typeof e.onReady && e.onReady(e.ctx, e), 
        n ? e.pushOrign(n) : e.updateCanvas(), t(e, !1, !1, !1), e.oldScale = 1, e.newScale = 1, 
        e;
    }, Object.assign(S.prototype, w), S.prototype.prepare = function() {
        var t = this;
        t.attachPage = function() {
            var e = getCurrentPages(), n = e[e.length - 1];
            Object.defineProperty(n, "wecropper", {
                get: function() {
                    return console.warn("Instance will not be automatically bound to the page after v1.4.0\n\nPlease use a custom instance name instead\n\nExample: \nthis.mycropper = new WeCropper(options)\n\n// ...\nthis.mycropper.getCropperImage()"), 
                    t;
                },
                configurable: !0
            });
        }, t.createCtx = function() {
            var e = t.id, n = t.targetId;
            e ? (t.ctx = t.ctx || wx.createCanvasContext(e), t.targetCtx = t.targetCtx || wx.createCanvasContext(n)) : console.error("constructor: create canvas context failed, 'id' must be valuable");
        }, t.deviceRadio = f / 750;
    }, S.prototype.observer = function() {
        var t = this;
        t.on = function(e, n) {
            var o;
            return -1 < v.indexOf(e) ? p(n) && ("ready" === e ? n(t) : t["on" + ((o = e).charAt(0).toUpperCase() + o.slice(1))] = n) : console.error("event: " + e + " is invalid"), 
            t;
        };
    }, S.prototype.methods = function() {
        var t = this, e = t.width, n = t.height, o = t.id, r = t.targetId, a = t.pixelRatio, c = t.cut, u = c.x;
        void 0 === u && (u = 0);
        var s = c.y;
        void 0 === s && (s = 0);
        var d = c.width;
        void 0 === d && (d = e);
        var f = c.height;
        void 0 === f && (f = n), t.updateCanvas = function(e) {
            return t.croperTarget && t.ctx.drawImage(t.croperTarget, t.imgLeft, t.imgTop, t.scaleWidth, t.scaleHeight), 
            p(t.onBeforeDraw) && t.onBeforeDraw(t.ctx, t), t.setBoundStyle(t.boundStyle), t.ctx.draw(!1, e), 
            t;
        }, t.pushOrigin = t.pushOrign = function(e) {
            return t.src = e, p(t.onBeforeImageLoad) && t.onBeforeImageLoad(t.ctx, t), y({
                src: e
            }).then(function(e) {
                var n = e.width / e.height, o = d / f;
                return t.croperTarget = e.path, n < o ? (t.rectX = u, t.baseWidth = d, t.baseHeight = d / n, 
                t.rectY = s - Math.abs((f - t.baseHeight) / 2)) : (t.rectY = s, t.baseWidth = f * n, 
                t.baseHeight = f, t.rectX = u - Math.abs((d - t.baseWidth) / 2)), t.imgLeft = t.rectX, 
                t.imgTop = t.rectY, t.scaleWidth = t.baseWidth, t.scaleHeight = t.baseHeight, t.update(), 
                new Promise(function(e) {
                    t.updateCanvas(e);
                });
            }).then(function() {
                p(t.onImageLoad) && t.onImageLoad(t.ctx, t);
            });
        }, t.removeImage = function() {
            return t.src = "", t.croperTarget = "", i(t.ctx);
        }, t.getCropperBase64 = function(t) {
            void 0 === t && (t = function() {}), b({
                canvasId: o,
                x: u,
                y: s,
                width: d,
                height: f
            }, t);
        }, t.getCropperImage = function(e, n) {
            var c = e, h = {
                canvasId: o,
                x: u,
                y: s,
                width: d,
                height: f
            }, l = function() {
                return Promise.resolve();
            };
            return g(c) && c.original && (l = function() {
                return t.targetCtx.drawImage(t.croperTarget, t.imgLeft * a, t.imgTop * a, t.scaleWidth * a, t.scaleHeight * a), 
                h = {
                    canvasId: r,
                    x: u * a,
                    y: s * a,
                    width: d * a,
                    height: f * a
                }, i(t.targetCtx);
            }), l().then(function() {
                g(c) && (h = Object.assign({}, h, c)), p(c) && (n = c);
                var t = h.componentContext ? [ h, h.componentContext ] : [ h ];
                return x.apply(null, t);
            }).then(function(e) {
                var o = e.tempFilePath;
                return p(n) ? n.call(t, o, null) : o;
            }).catch(function(e) {
                if (!p(n)) throw e;
                n.call(t, null, e);
            });
        };
    }, S.prototype.cutt = function() {
        var t = this, e = t.width, n = t.height, o = t.cut, r = o.x;
        void 0 === r && (r = 0);
        var i = o.y;
        void 0 === i && (i = 0);
        var a = o.width;
        void 0 === a && (a = e);
        var c = o.height;
        void 0 === c && (c = n), t.outsideBound = function(e, n) {
            t.imgLeft = r <= e ? r : t.scaleWidth + e - r <= a ? r + a - t.scaleWidth : e, t.imgTop = i <= n ? i : t.scaleHeight + n - i <= c ? i + c - t.scaleHeight : n;
        }, t.setBoundStyle = function(o) {
            void 0 === o && (o = {});
            var u = o.color;
            void 0 === u && (u = "#04b00f");
            var s = o.mask;
            void 0 === s && (s = "rgba(0, 0, 0, 0.3)");
            var d = o.lineWidth;
            void 0 === d && (d = 1);
            var f = d / 2, h = [ {
                start: {
                    x: r - f,
                    y: i + 10 - f
                },
                step1: {
                    x: r - f,
                    y: i - f
                },
                step2: {
                    x: r + 10 - f,
                    y: i - f
                }
            }, {
                start: {
                    x: r - f,
                    y: i + c - 10 + f
                },
                step1: {
                    x: r - f,
                    y: i + c + f
                },
                step2: {
                    x: r + 10 - f,
                    y: i + c + f
                }
            }, {
                start: {
                    x: r + a - 10 + f,
                    y: i - f
                },
                step1: {
                    x: r + a + f,
                    y: i - f
                },
                step2: {
                    x: r + a + f,
                    y: i + 10 - f
                }
            }, {
                start: {
                    x: r + a + f,
                    y: i + c - 10 + f
                },
                step1: {
                    x: r + a + f,
                    y: i + c + f
                },
                step2: {
                    x: r + a - 10 + f,
                    y: i + c + f
                }
            } ];
            t.ctx.beginPath(), t.ctx.setFillStyle(s), t.ctx.fillRect(0, 0, r, n), t.ctx.fillRect(r, 0, a, i), 
            t.ctx.fillRect(r, i + c, a, n - i - c), t.ctx.fillRect(r + a, 0, e - r - a, n), 
            t.ctx.fill(), h.forEach(function(e) {
                t.ctx.beginPath(), t.ctx.setStrokeStyle(u), t.ctx.setLineWidth(d), t.ctx.moveTo(e.start.x, e.start.y), 
                t.ctx.lineTo(e.step1.x, e.step1.y), t.ctx.lineTo(e.step2.x, e.step2.y), t.ctx.stroke();
            });
        };
    }, S.prototype.update = function() {
        var t = this;
        t.src && (t.__oneTouchStart = function(e) {
            t.touchX0 = Math.round(e.x), t.touchY0 = Math.round(e.y);
        }, t.__oneTouchMove = function(e) {
            var n, o;
            if (t.touchended) return t.updateCanvas();
            n = Math.round(e.x - t.touchX0), o = Math.round(e.y - t.touchY0);
            var r = Math.round(t.rectX + n), i = Math.round(t.rectY + o);
            t.outsideBound(r, i), t.updateCanvas();
        }, t.__twoTouchStart = function(e, n) {
            var o, r, i;
            t.touchX1 = Math.round(t.rectX + t.scaleWidth / 2), t.touchY1 = Math.round(t.rectY + t.scaleHeight / 2), 
            o = Math.round(n.x - e.x), r = Math.round(n.y - e.y), i = Math.round(Math.sqrt(o * o + r * r)), 
            t.oldDistance = i;
        }, t.__twoTouchMove = function(e, n) {
            var o, r, i, a, c, u, s, d = t.oldScale, f = t.oldDistance, h = t.scale, l = t.zoom;
            t.newScale = (o = d, r = f, i = l, a = e, c = n, u = Math.round(c.x - a.x), s = Math.round(c.y - a.y), 
            o + .001 * i * (Math.round(Math.sqrt(u * u + s * s)) - r)), t.newScale <= 1 && (t.newScale = 1), 
            t.newScale >= h && (t.newScale = h), t.scaleWidth = Math.round(t.newScale * t.baseWidth), 
            t.scaleHeight = Math.round(t.newScale * t.baseHeight);
            var p = Math.round(t.touchX1 - t.scaleWidth / 2), g = Math.round(t.touchY1 - t.scaleHeight / 2);
            t.outsideBound(p, g), t.updateCanvas();
        }, t.__xtouchEnd = function() {
            t.oldScale = t.newScale, t.rectX = t.imgLeft, t.rectY = t.imgTop;
        });
    }, S;
}, "object" == ("undefined" == typeof exports ? "undefined" : n(exports)) && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : (void 0).WeCropper = t();